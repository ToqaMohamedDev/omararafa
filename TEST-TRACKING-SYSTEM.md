# ๐ ูุธุงู ุชุชุจุน ุงูููุงุฐุฌ ูุงูุงุฎุชุจุงุฑุงุช

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ูุธุงู ูุงูู ูุชุชุจุน ุนุฏุฏ ุงูููุงุฐุฌ ูุงูุงุฎุชุจุงุฑุงุช ุงูุชู ุชู ุญููุง ูููุงุณ ูุณุชูู ุงูุทุงูุจ ุจูุงุกู ุนูู ุงููุชุงุฆุฌ.

---

## ๐ฏ ุงููููุฒุงุช

### 1. **ุชุชุจุน ุงููุชุงุฆุฌ**
- ุญูุธ ุฌููุน ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑุงุช ูู Firestore
- ุชุชุจุน ุนุฏุฏ ุงูุงุฎุชุจุงุฑุงุช ุงูููุชููุฉ
- ุญุณุงุจ ุงููุนุฏู ุงูุนุงู ููุทุงูุจ

### 2. **ุญุณุงุจ ุงููุณุชูู ุงูุชููุงุฆู**
- ุญุณุงุจ ุงููุณุชูู ุจูุงุกู ุนูู:
  - ุนุฏุฏ ุงูุงุฎุชุจุงุฑุงุช ุงูููุชููุฉ
  - ุงููุนุฏู ุงูุนุงู ูููุชุงุฆุฌ
- ุชุญุฏูุซ ุงููุณุชูู ุชููุงุฆูุงู ูู ุงูุจุฑููุงูู

### 3. **ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช**
- ุนุฑุถ ุนุฏุฏ ุงูุงุฎุชุจุงุฑุงุช ุงูููุชููุฉ
- ุนุฑุถ ุงููุนุฏู ุงูุนุงู
- ุนุฑุถ ุงููุณุชูู ุงูุญุงูู
- ุนุฑุถ ุณุงุนุงุช ุงูุชุนูู (ุชูุฏูุฑูุฉ)

---

## ๐ ุงููููุงุช ุงููุถุงูุฉ/ุงููุญุฏุซุฉ

### 1. **API Route**
**`app/api/tests/results/route.ts`**
- `POST`: ุญูุธ ูุชูุฌุฉ ุงุฎุชุจุงุฑ ุฌุฏูุฏ
- `GET`: ุฌูุจ ุฌููุน ูุชุงุฆุฌ ุงููุณุชุฎุฏู
- `calculateAndUpdateUserLevel()`: ุญุณุงุจ ุงููุณุชูู ุจูุงุกู ุนูู ุงููุชุงุฆุฌ
- `updateUserLevel()`: ุชุญุฏูุซ ูุณุชูู ุงููุณุชุฎุฏู ูู Firestore

### 2. **ุตูุญุฉ ุงูุงุฎุชุจุงุฑุงุช**
**`app/tests/page.tsx`**
- ุชุญุฏูุซ `handleNext()` ูุฅุฑุณุงู `totalQuestions` ูุน ุงููุชูุฌุฉ

### 3. **ุตูุญุฉ ุงูุจุฑููุงูู**
**`app/profile/page.tsx`**
- ุฌูุจ ุงูุฅุญุตุงุฆูุงุช ุงูุญููููุฉ ูู API
- ุนุฑุถ ุงูุจูุงูุงุช ุงูุญููููุฉ ุจุฏูุงู ูู ุงูุจูุงูุงุช ุงูุซุงุจุชุฉ
- ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ุชููุงุฆูุงู

### 4. **Session Hook**
**`hooks/useSession.tsx`**
- ุชุญุฏูุซ `User` interface ูุฅุถุงูุฉ ุงูุญููู ุงูุฌุฏูุฏุฉ:
  - `level`: ุงููุณุชูู ุงูุญุงูู
  - `levelScore`: ููุงุท ุงููุณุชูู (1-5)
  - `averageScore`: ุงููุนุฏู ุงูุนุงู
  - `completedTests`: ุนุฏุฏ ุงูุงุฎุชุจุงุฑุงุช ุงูููุชููุฉ

### 5. **Firestore Rules**
**`firestore.rules`**
- ุฅุถุงูุฉ ููุงุนุฏ `testResults` collection:
  - ุงููุณุชุฎุฏู ููููู ูุฑุงุกุฉ ูุชุงุฆุฌู ููุท
  - ุงููุณุชุฎุฏู ููููู ุฅูุดุงุก ูุชูุฌุฉ ูููุณู ููุท
  - ุงูุฃุฏูู ููููู ุชุญุฏูุซ/ุญุฐู ุงููุชุงุฆุฌ

---

## ๐๏ธ ูููู ุงูุจูุงูุงุช

### **testResults Collection**
```typescript
{
  userId: string;           // ID ุงููุณุชุฎุฏู
  testId: string;          // ID ุงูุงุฎุชุจุงุฑ
  score: number;           // ุนุฏุฏ ุงูุฅุฌุงุจุงุช ุงูุตุญูุญุฉ
  percentage: number;      // ุงููุณุจุฉ ุงููุฆููุฉ
  totalQuestions: number;  // ุฅุฌูุงูู ุนุฏุฏ ุงูุฃุณุฆูุฉ
  answers: object;         // ุงูุฅุฌุงุจุงุช ุงูููุฏูุฉ
  createdAt: timestamp;    // ุชุงุฑูุฎ ุงูุญูุธ
}
```

### **users Collection (ุญููู ุฌุฏูุฏุฉ)**
```typescript
{
  level: string;           // ุงููุณุชูู: "ูุจุชุฏุฆ" | "ูุจุชุฏุฆ ูุชูุฏู" | "ูุชูุณุท" | "ูุชูุฏู" | "ููุชุงุฒ"
  levelScore: number;      // ููุงุท ุงููุณุชูู: 1-5
  averageScore: number;    // ุงููุนุฏู ุงูุนุงู (0-100)
  completedTests: number; // ุนุฏุฏ ุงูุงุฎุชุจุงุฑุงุช ุงูููุชููุฉ
}
```

---

## ๐ ูุธุงู ุญุณุงุจ ุงููุณุชูู

### **ุงููุณุชููุงุช:**

| ุงููุณุชูู | ุงูุดุฑูุท | levelScore |
|---------|---------|------------|
| **ูุจุชุฏุฆ** | ุฃูู ูู 5 ุงุฎุชุจุงุฑุงุช ุฃู ูุนุฏู ุฃูู ูู 60% | 1 |
| **ูุจุชุฏุฆ ูุชูุฏู** | 5+ ุงุฎุชุจุงุฑุงุช ููุนุฏู 60%+ | 2 |
| **ูุชูุณุท** | 10+ ุงุฎุชุจุงุฑุงุช ููุนุฏู 70%+ | 3 |
| **ูุชูุฏู** | 15+ ุงุฎุชุจุงุฑุงุช ููุนุฏู 80%+ | 4 |
| **ููุชุงุฒ** | 20+ ุงุฎุชุจุงุฑุงุช ููุนุฏู 90%+ | 5 |

### **ูุซุงู:**
```javascript
// ุทุงูุจ ุฃููู 12 ุงุฎุชุจุงุฑ ุจูุนุฏู 75%
// ุงููุณุชูู: "ูุชูุณุท" (levelScore: 3)

// ุทุงูุจ ุฃููู 25 ุงุฎุชุจุงุฑ ุจูุนุฏู 92%
// ุงููุณุชูู: "ููุชุงุฒ" (levelScore: 5)
```

---

## ๐ ุชุฏูู ุงูุจูุงูุงุช

### **ุนูุฏ ุฅุชูุงู ุงุฎุชุจุงุฑ:**

```
1. ุงููุณุชุฎุฏู ูููู ุงูุงุฎุชุจุงุฑ
   โ
2. ุญุณุงุจ ุงููุชูุฌุฉ (score, percentage)
   โ
3. POST /api/tests/results
   โ
4. ุญูุธ ุงููุชูุฌุฉ ูู testResults collection
   โ
5. ุญุณุงุจ ุงููุณุชูู ุงูุฌุฏูุฏ ุจูุงุกู ุนูู ุฌููุน ุงููุชุงุฆุฌ
   โ
6. ุชุญุฏูุซ users collection (level, levelScore, averageScore, completedTests)
   โ
7. ุชุญุฏูุซ ุงูุจุฑููุงูู ุชููุงุฆูุงู
```

### **ุนูุฏ ูุชุญ ุงูุจุฑููุงูู:**

```
1. ุชุญููู ุจูุงูุงุช ุงููุณุชุฎุฏู ูู Firestore
   โ
2. GET /api/tests/results?userId=...
   โ
3. ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช ูู ุงููุชุงุฆุฌ
   โ
4. ุนุฑุถ ุงูุจูุงูุงุช ูู ุงูุจุฑููุงูู
```

---

## ๐ ุงูุฃูุงู

### **Firestore Rules:**

```javascript
match /testResults/{resultId} {
  // ุงููุณุชุฎุฏู ููููู ูุฑุงุกุฉ ูุชุงุฆุฌู ููุท
  allow read: if request.auth != null && 
                 resource.data.userId == request.auth.uid;
  
  // ุงููุณุชุฎุฏู ููููู ุฅูุดุงุก ูุชูุฌุฉ ูููุณู ููุท
  allow create: if request.auth != null &&
                   request.resource.data.userId == request.auth.uid;
  
  // ุงูุฃุฏูู ููุท ููููู ุชุญุฏูุซ/ุญุฐู
  allow update, delete: if isAdmin();
}
```

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ุงููุนุฑูุถุฉ

### **ูู ุงูุจุฑููุงูู:**

1. **ุงูุงุฎุชุจุงุฑุงุช ุงูููุชููุฉ**
   - ุนุฏุฏ ุงูุงุฎุชุจุงุฑุงุช ุงูุชู ุฃููููุง ุงููุณุชุฎุฏู

2. **ุงููุนุฏู ุงูุนุงู**
   - ูุชูุณุท ุงููุณุจุฉ ุงููุฆููุฉ ูุฌููุน ุงูุงุฎุชุจุงุฑุงุช

3. **ุณุงุนุงุช ุงูุชุนูู**
   - ุชูุฏูุฑ: 30 ุฏูููุฉ ููู ุงุฎุชุจุงุฑ
   - `completedTests * 0.5` ุณุงุนุฉ

4. **ุงููุณุชูู**
   - ุงููุณุชูู ุงูุญุงูู ุจูุงุกู ุนูู ุงููุชุงุฆุฌ

---

## ๐ ุงูุงุณุชุฎุฏุงู

### **ูู ุงูููุฏ:**

```typescript
// ุญูุธ ูุชูุฌุฉ ุงุฎุชุจุงุฑ
await fetch("/api/tests/results", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    userId: user.uid,
    testId: testId,
    score: correctAnswers,
    percentage: percentage,
    totalQuestions: totalQuestions,
    answers: answers,
  }),
});

// ุฌูุจ ุงููุชุงุฆุฌ
const response = await fetch(`/api/tests/results?userId=${userId}`);
const { results } = await response.json();
```

---

## โ ุงูููุงู ุงูููุชููุฉ

- [x] ุฅูุดุงุก API route ูุญูุธ ุงููุชุงุฆุฌ
- [x] ุฅูุดุงุก ุฏุงูุฉ ูุญุณุงุจ ุงููุณุชูู
- [x] ุชุญุฏูุซ User interface
- [x] ุชุญุฏูุซ ุงูุจุฑููุงูู ูุนุฑุถ ุงูุจูุงูุงุช ุงูุญููููุฉ
- [x] ุชุญุฏูุซ Firestore Rules
- [x] ุชุญุฏูุซ ุตูุญุฉ ุงูุงุฎุชุจุงุฑุงุช

---

## ๐ ููุงุญุธุงุช

1. **ุงูุชุญุฏูุซ ุงูุชููุงุฆู:**
   - ูุชู ุชุญุฏูุซ ุงููุณุชูู ุชููุงุฆูุงู ุนูุฏ ุญูุธ ูุชูุฌุฉ ุฌุฏูุฏุฉ
   - ูุชู ุชุญุฏูุซ ุงูุจุฑููุงูู ุนูุฏ ูุชุญู

2. **ุงูุฃุฏุงุก:**
   - ูุชู ุญุณุงุจ ุงููุณุชูู ููุท ุนูุฏ ุญูุธ ูุชูุฌุฉ ุฌุฏูุฏุฉ
   - ูุชู ุฌูุจ ุงููุชุงุฆุฌ ุนูุฏ ูุชุญ ุงูุจุฑููุงูู

3. **ุงูุชูุงูู:**
   - ุงููุธุงู ูุชูุงูู ูุน ุงูุจูุงูุงุช ุงููุฏููุฉ
   - ุงููุณุชุฎุฏููู ุงูุฌุฏุฏ ูุจุฏุฃูู ูู ูุณุชูู "ูุจุชุฏุฆ"

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุฅูุดุงุก ูุธุงู ูุงูู ูููู ูุชุชุจุน ุงูููุงุฐุฌ ูุงูุงุฎุชุจุงุฑุงุช ูุน:
- โ ุญูุธ ุงููุชุงุฆุฌ ุชููุงุฆูุงู
- โ ุญุณุงุจ ุงููุณุชูู ุจูุงุกู ุนูู ุงูุฃุฏุงุก
- โ ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ูู ุงูุจุฑููุงูู
- โ ุชุญุฏูุซ ุชููุงุฆู ูููุณุชูู
- โ ุฃูุงู ูุงูู ูู Firestore Rules

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู! ๐

